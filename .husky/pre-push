#!/usr/bin/env sh

# OvenAI Pre-Push Quality Checks (Simplified for Demo)
echo "ğŸš€ Running pre-push quality checks..."

# Function to check if we're on main/master branch
is_main_branch() {
  local current_branch
  current_branch=$(git rev-parse --abbrev-ref HEAD)
  [[ "$current_branch" == "main" || "$current_branch" == "master" ]]
}

# Enhanced checks for main/master branch
if is_main_branch; then
  echo "ğŸ¯ Enhanced checks for main branch..."
  
  # 1. TypeScript compilation
  echo "ğŸ”§ Checking TypeScript compilation..."
  npm run type-check || {
    echo "âŒ TypeScript compilation failed"
    exit 1
  }
  echo "âœ… TypeScript check passed"
  
  # 2. Linting
  echo "ğŸ§¹ Running linter..."
  npm run lint || {
    echo "âŒ Linting failed"
    exit 1
  }
  echo "âœ… Linting passed"
  
  # 3. Quick build test (skip E2E tests for speed)
  echo "ğŸ”¨ Testing production build..."
  npm run build > /dev/null 2>&1 || {
    echo "âŒ Build failed - fix before pushing!"
    exit 1
  }
  echo "âœ… Build test passed"
  
  echo "ğŸ‰ All main branch checks passed!"
  
else
  echo "ğŸ”§ Development branch - running quick checks..."
  
  # Basic TypeScript check
  npm run type-check || {
    echo "âš ï¸ TypeScript errors - consider fixing"
  }
  
  echo "âœ… Development branch checks completed"
fi

echo "âœ… Pre-push checks completed successfully!"
